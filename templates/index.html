{% extends "base.html" %}

{% block content %}
<div class="container-fluid">
    <!-- Ê∑ªÂä†ÈºìÂä±ËØ≠ -->
    <div class="row mb-4">
        <div class="col">
            <div class="card">
                <div class="card-body text-center">
                    <p class="h3 text-primary mb-0" style="font-family: 'Helvetica Neue', sans-serif;">
                        ‚ñ° {{ current_user.name }}, You can do anything!‚ú®üê∂‚úÖ ‚ñ°
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Â∑¶‰æßÊ†è - Ë°®Âçï -->
        <div class="col-md-4">
            <!-- Add New Project Ë°®Âçï -->
            <div class="card mb-4">
                <div class="card-header">
                    <h3>Add New Project</h3>
                </div>
                <div class="card-body">
                    <form action="{{ url_for('add_project') }}" method="POST">
                        <div class="form-group mb-3">
                            <label for="project_number">Project Number</label>
                            <input type="text" class="form-control" id="project_number" name="project_number" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="project_info">Project Information (Optional)</label>
                            <textarea class="form-control" id="project_info" name="project_info" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Create Project</button>
                    </form>
                </div>
            </div>

            <!-- Add New Task Ë°®Âçï -->
            <div class="card">
                <div class="card-header">
                    <h3>Add New Task</h3>
                </div>
                <div class="card-body">
                    <form action="{{ url_for('add_task') }}" method="POST">
                        <div class="form-group mb-3">
                            <label for="project_id">Project</label>
                            <select class="form-control" id="project_id" name="project_id" required>
                                {% for project in projects %}
                                <option value="{{ project.id }}">{{ project.project_number }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group mb-3">
                            <label for="name">Task Name</label>
                            <input type="text" class="form-control" id="name" name="name" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="estimated_time">Estimated Time (hours)</label>
                            <input type="number" class="form-control" id="estimated_time" name="estimated_time" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="deadline">Deadline</label>
                            <input type="date" class="form-control" id="deadline" name="deadline" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="priority">Priority (0-5, 0 being most urgent)</label>
                            <input type="number" class="form-control" id="priority" name="priority" min="0" max="5" value="3" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Task</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Âè≥‰æßÊ†è - ‰ªªÂä°ÂàóË°® -->
        <div class="col-md-8">
            <!-- Uncompleted Tasks -->
            <div class="card mb-4">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h3>Uncompleted Tasks</h3>
                        <span class="badge bg-primary">{{ uncompleted_tasks|length }}</span>
                    </div>
                    <div class="input-group">
                        <span class="input-group-text"><i class="bi bi-search"></i></span>
                        <input type="text" class="form-control" id="uncompleted-search" placeholder="Search by project number...">
                    </div>
                </div>
                <div class="card-body">
                    {% for task in uncompleted_tasks %}
                    <div class="task-card mb-3 p-3 rounded" data-project="{{ task.project.project_number }}" style="background-color: {% if task.priority == 0 %}#ffebee{% elif task.priority == 1 %}#fff3e0{% elif task.priority == 2 %}#fffde7{% else %}#f1f8e9{% endif %}">
                        <h5>{{ task.name }}</h5>
                        <p class="mb-1">Project: {{ task.project.project_number }}</p>
                        <p class="mb-1">Estimated Time: {{ task.estimated_time }} hours</p>
                        <p class="mb-1">Deadline: {{ task.deadline.strftime('%Y-%m-%d') }}</p>
                        <p class="mb-2">Priority: {{ task.priority }}</p>
                        <div class="btn-group">
                            <form action="{{ url_for('complete_task', task_id=task.id) }}" method="POST" class="me-2">
                                <button type="submit" class="btn btn-success btn-sm">Complete</button>
                            </form>
                            <form action="{{ url_for('delete_task', task_id=task.id) }}" method="POST">
                                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                            </form>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Completed Tasks -->
            <div class="card">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h3>Completed Tasks</h3>
                    </div>
                    <div class="input-group">
                        <span class="input-group-text"><i class="bi bi-search"></i></span>
                        <input type="text" class="form-control" id="completed-search" placeholder="Search by project number...">
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Task Name</th>
                                    <th>Project</th>
                                    <th>Completed Date</th>
                                    <th>Deadline</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for task in completed_tasks %}
                                <tr data-project="{{ task.project.project_number }}">
                                    <td>{{ task.name }}</td>
                                    <td>{{ task.project.project_number }}</td>
                                    <td>{{ task.deadline.strftime('%Y-%m-%d') }}</td>
                                    <td>{{ task.deadline.strftime('%Y-%m-%d') }}</td>
                                    <td>
                                        <div class="btn-group">
                                            <form action="{{ url_for('restore_task', task_id=task.id) }}" method="POST" class="me-2">
                                                <button type="submit" class="btn btn-warning btn-sm">Restore</button>
                                            </form>
                                            <form action="{{ url_for('delete_task', task_id=task.id) }}" method="POST">
                                                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Ê∑ªÂä†ÊêúÁ¥¢ÂäüËÉΩÁöÑ JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Êú™ÂÆåÊàê‰ªªÂä°ÊêúÁ¥¢
    const uncompletedSearch = document.getElementById('uncompleted-search');
    uncompletedSearch.addEventListener('input', function(e) {
        const searchValue = e.target.value.toLowerCase();
        const taskCards = document.querySelectorAll('.task-card');
        
        taskCards.forEach(card => {
            const projectNumber = card.getAttribute('data-project').toLowerCase();
            if (projectNumber.includes(searchValue)) {
                card.style.display = '';
            } else {
                card.style.display = 'none';
            }
        });
    });

    // Â∑≤ÂÆåÊàê‰ªªÂä°ÊêúÁ¥¢
    const completedSearch = document.getElementById('completed-search');
    completedSearch.addEventListener('input', function(e) {
        const searchValue = e.target.value.toLowerCase();
        const taskRows = document.querySelectorAll('tbody tr');
        
        taskRows.forEach(row => {
            const projectNumber = row.getAttribute('data-project').toLowerCase();
            if (projectNumber.includes(searchValue)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    });
});
</script>
{% endblock %} 